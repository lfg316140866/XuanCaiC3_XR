var musicId="";
var mycv = document.getElementById("canvas");
var hasmove = true;
$(function(){
	var l = new land2();
	$(window).resize(function(){
		l.fitwin();
	})

	/*$(".wrapper").bind("touchstart",function(){ 
		event.preventDefault();
	});*/
})
var land2 = function(){
	var _this = this;
	setTimeout(function(){ _this.init(); }, 500)
	//this.init();
}
land2.prototype = {
	init:function(){
		var _self = this;
		_self.fitwin();
		_self.loadimg();
	},
	loadimg:function(){
		var _self = this;
		var imgarr = ['arrow_three.png','checkbox.png','checkbox_check.png','color_list.png','home_bg.jpg','icon_arrow.png','step_next.png','step_next1.png','step_prev.png','step_1.png','step_2.png','step_3.png','step_bottom.png','step_title_1.png','step_title_2.png','step_title_3.png','step4_bottom.png','logo.png','page_bg.jpg','pic_select.png','register_bg.jpg','rule_pic.png','share_over.png','canvas/chaoliu/cl_1.png','canvas/chaoliu/cl_2.png','canvas/chaoliu/cl_3.png','canvas/chaoliu/cl_4.png','canvas/chaoliu/cl_5.png','canvas/chaoliu/cl_6.png','canvas/chaoliu/cl_7.png','canvas/chaoliu/cl_8.png','canvas/chaoliu/cl_9.png','canvas/chaoliu/cl_10.png','canvas/chaoliu/cl_11.png','canvas/chaoliu/cl_12.png','canvas/chaoliu/cl_13.png','canvas/chaoliu/cl_14.png','canvas/chaoliu/cl_15.png','canvas/chaoliu/cl_16.png','canvas/chaoliu/cl_17.png','canvas/chaoliu/cl_18.png','canvas/chaoliu/cl_19.png','canvas/chaoliu/cl_20.png','canvas/chaoliu/cl_21.png','canvas/chaoliu/cl_22.png','canvas/chaoliu/cl_23.png','canvas/chaoliu/cl_24.png','canvas/chaoliu/cl_25.png','canvas/chaoliu/cl_26.png','canvas/chaoliu/cl_27.png','canvas/chaoliu/cl_28.png','canvas/music/m_1.png','canvas/music/m_2.png','canvas/music/m_3.png','canvas/music/m_4.png','canvas/music/m_5.png','canvas/music/m_6.png','canvas/music/m_7.png','canvas/music/m_8.png','canvas/music/m_9.png','canvas/music/m_10.png','canvas/music/m_11.png','canvas/music/m_12.png','canvas/music/m_13.png','canvas/music/m_14.png','canvas/music/m_15.png','canvas/music/m_16.png','canvas/music/m_17.png','canvas/music/m_18.png','canvas/music/m_19.png','canvas/music/m_20.png','canvas/music/m_21.png','canvas/music/m_22.png','canvas/music/m_23.png','canvas/music/m_24.png','canvas/music/m_25.png','canvas/music/m_26.png','canvas/music/m_27.png','canvas/yingxiang/yx_1.png','canvas/yingxiang/yx_2.png','canvas/yingxiang/yx_3.png','canvas/yingxiang/yx_4.png','canvas/yingxiang/yx_5.png','canvas/yingxiang/yx_6.png','canvas/yingxiang/yx_7.png','canvas/yingxiang/yx_8.png','canvas/yingxiang/yx_9.png','canvas/yingxiang/yx_10.png','canvas/yingxiang/yx_11.png','canvas/yingxiang/yx_12.png','canvas/yingxiang/yx_13.png','canvas/yingxiang/yx_14.png','canvas/yingxiang/yx_15.png','canvas/yingxiang/yx_16.png','canvas/yingxiang/yx_17.png','canvas/yingxiang/yx_18.png','canvas/yingxiang/yx_19.png','canvas/yingxiang/yx_20.png','canvas/yingxiang/yx_21.png','canvas/yingxiang/yx_22.png','canvas/yingxiang/yx_23.png','canvas/yingxiang/yx_24.png','canvas/yingxiang/yx_25.png','canvas/yingxiang/yx_26.png','canvas/yingxiang/yx_27.png'];
		new wrLoading('.loading',imgarr,function(){
			_self.start();
		});
	},
	start:function(){
		$(".loading").fadeOut();
		 maininit();
	},
	fitwin:function(){
		
	}
}
function progressHandle(progress){
	//var p = parseInt(progress*100);
	//$(".loading_num").html(p+"%");
	//console.log(progress);
}
function maininit(){
	setTimeout(function(){
		pageInit();
		new PCAS("province", "city", "area");
		listenList();
	},2500)
	$(".btn_rule").click(function(){
		$(".rule").fadeIn();
	})
	$(".rule_close").click(function(){
		$(".rule").fadeOut();
	})
	$(".btn_join").click(function(){
		$(".create").fadeIn();
		//$(".userinfo,.step4_input,.step4,.step3,.step2").hide();
	})

	$(".car_color li").click(function(){
		var cc = $(this).index()+1;
		car(cc);
	})
	$(".car_top li").click(function(){
		var cc = $(this).index()+1;
		console.log(cc);
		car_top(cc);
	})
	$(".btn_car_top").click(function(){
		$(".car_color").hide();
		$(".car_top").show();
		$("#select_arrow").attr("class","select_top");
	})
	$(".btn_car_color").click(function(){
		$(".car_color").show();
		$(".car_top").hide();
		$("#select_arrow").attr("class","select_color");
	})
	$("#btn_next1").click(function(){
		$(".step1,#step2,#step3").hide();
		$(".step2,#step1").show();
		$("#select_arrow").attr("class","select_chaoliu");
		$(".btn_delete").show();
	})

	$(".bottom_banner").click(function(){
		$(".banner_pic").fadeIn();
	})
}
function pageInit(){
	/*var cl="";
	var clnum = 28;
	for(var i=1;i<=clnum;i++){
		cl+='<li class="swiper-slide"><img src="images/canvas/chaoliu/cl_'+i+'.png" /></li>';
	}
	$("#chaoliu").append(cl);*/
	$(".btn_delete").click(function(){
		removeImage();
	})
	$("#chaoliu li img,#music li img,#yingxiang li img").each(function(){
		var img = new Image();
		img.src =$(this).attr("src") ;
		var w = img.width;
		var h = img.height;
		var t = (172-h)/2
		$(this).css("margin-top",t+"px");
		$(this).parent().width(w);
	})
	var mySwiper = new Swiper('#chaoliu', {
	    slidesPerView: 'auto',
	    //centeredSlides: false,
	    paginationClickable: true,
	    spaceBetween: 30,
	    nextButton: '.car_cl_next',
	    prevButton: '.car_cl_prev',
	    freeMode: true
	});
	var mySwiper2 = new Swiper('#music', {
	    slidesPerView: 'auto',
	    //centeredSlides: false,
	    paginationClickable: true,
	    spaceBetween: 30,
	    nextButton: '.car_music_next',
	    prevButton: '.car_music_prev',
	    freeMode: true
	});
	var mySwiper3 = new Swiper('#yingxiang', {
	    slidesPerView: 'auto',
	    //centeredSlides: false,
	    paginationClickable: true,
	    spaceBetween: 30,
	    nextButton: '.car_yingxiang_next',
	    prevButton: '.car_yingxiang_prev',
	    freeMode: true
	});
	
}

function listenList(){
	
	$("#chaoliu li img,#music li img,#yingxiang li img").click(function(){
		var img = $(this).attr("src");
		console.log(img);
		addImage(img, 300, 10);
	})

	$(".btn_chaoliu").click(function(){
		$(".car_music,.car_yingxiang").hide();
		$(".car_chaoliu").show();
		$("#select_arrow").attr("class","select_chaoliu");
	})
	$(".btn_music").click(function(){
		$(".car_chaoliu,.car_yingxiang").hide();
		$(".car_music").show();
		$("#select_arrow").attr("class","select_music");
	})
	$(".btn_yingxiang").click(function(){
		$(".car_chaoliu,.car_music").hide();
		$(".car_yingxiang").show();
		$("#select_arrow").attr("class","select_yingxiang");
	})

	
	$("#btn_prev2").click(function(){
		$(".step2,#step2,#step3").hide();
		$(".step1,#step1").show();
	})
	$("#btn_next2").click(function(){
		$(".step2,#step1,#step3").hide();
		$(".step3,#step2").show();
		$("#select_arrow").attr("class","select_color");
		hasmove = false;
		$(".btn_delete").hide();
		bg(0);
	})

	$(".btn_bmusic").click(function(){
		$(".car_background_image").hide();
		$(".car_background_music").show();
		$("#select_arrow").attr("class","select_color");
	})
	$(".btn_bpic").click(function(){
		$(".car_background_image").show();
		$(".car_background_music").hide();
		$("#select_arrow").attr("class","select_top");
	})
	$(".car_background_music li").click(function(){
		$(this).addClass("checked").siblings().removeClass("checked");
		musicId = $(this).index()+1;
		console.log(musicId);
		myAudio.setAttribute('src','music/'+musicId+'.mp3');                
		myAudio.play();
	})

	$(".car_background_image li").click(function(){
		$(this).addClass("selected").siblings().removeClass("selected");
		imageId = $(this).index()+1;
		bg(imageId);
	})

	$("#btn_prev3").click(function(){
		$(".step3,#step1,#step3").hide();
		$(".step2,#step2,.step_c").show();
		hasmove = true;
		$(".btn_delete").show();
	})
	$("#btn_next3").click(function(){
		$(".step3,#step2,#step1,.step_c").hide();
		$(".step4,#step3,.step4_input").show();
	})

	$(".btn_form").click(function(){
		//textAdd();
		txt.text = $(".text_input").val();
		setTimeout(function(){
			var picture = convertCanvasToImage(mycv);
			$("#ps").html(picture);
		},500)
		
		$(".userinfo").show();
	})

	$(".province").change(function(){
		$(".province_show").val($(this).val());
		$(".city_show").val($(".city").val());
		$(".area_show").val($(".area").val());
	})
	$(".city").change(function(){
		$(".city_show").val($(this).val());
		$(".area_show").val($(".area").val());
	})
	$(".area").change(function(){
		$(".area_show").val($(this).val());
	})

	$(".share").click(function(){
		//$(this).fadeOut();
		location.reload();
	})

}
var myAudio=new Audio();
myAudio.setAttribute('src','music/1.mp3');                
myAudio.loop = false;
function textAdd(){
	console.log("text");
	var myctx = mycv.getContext('2d');
	myctx.beginPath();
	myctx.font = "60px";
	myctx.fillStyle="#000";
	myctx.fillText("哈啊哈", 95, 460);
	myctx.stroke();

	/*var stage = new createjs.Stage(mycv);
	var txt = new createjs.Text("", "60px Arial", "#000");
	txt.x = 100;
	txt.y = 360;
	stage.addChild(txt);
	var shape = new createjs.Shape();
	shape.x = txt.x;
	shape.y = txt.y;
	stage.addChildAt(shape, 0);
	txt.text = "哈哈过";
	shape.graphics.clear().drawRect(0, 0, txt.getMeasuredWidth(), 60);
	stage.update(event);*/
}

function convertCanvasToImage(canvas) {
  var image = new Image();
  image.src = canvas.toDataURL("image/jpg");
  return image;
}

function isMobile(mobilephone){
 //var mobilephone = ('undefined' == typeof(mobilephone) ? $("#mobilephone").val() : mobilephone);
 var num_RegExp  = /^((((1[3,5,8,7]{1}[0-9]{1}))+\d{8})(,|;| )?)*$/;
 if(mobilephone){
 if(!num_RegExp.test(mobilephone)){
 return false;
 }
 }
 return true;
}

function submitLoading(){
	$(".submit_loading").fadeIn();
}
function removeLoading(){
	$(".submit_loading").fadeOut();
}
function shareShow(img){
	$("#sharePic").attr("src",img);
	$(".share").fadeIn();
	$(".create").hide();
	removeLoading();
}